<div class="container-fluid">
  <div class="row">
    <div class="col">
      <dx-data-grid [columnAutoWidth]="true" [allowColumnResizing]="true" columnResizingMode="nextColumn" id="gridContainer" [dataSource]="planItemsStore"
        [showRowLines]="true" [rowAlternationEnabled]="true">
        <!-- [dataSource]="(planItemState$ | async).entities" -->

        <dxo-filter-row [visible]="true"></dxo-filter-row>

        <dxo-remote-operations [filtering]="true" [sorting]="false" [grouping]="false" [paging]="true" [summary]="false">
        </dxo-remote-operations>
        <!-- 
        <dxo-filter-row [visible]="true">
        </dxo-filter-row> -->
        <dxo-paging [pageSize]="12"></dxo-paging>
        <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[8, 12, 20]" [showInfo]="true" [showNavigationButtons]="true">
        </dxo-pager>

        <dxi-column dataField="code" caption="Šifra naloga"></dxi-column>
        <dxi-column dataField="" caption="Vrsta proizvodnje"></dxi-column>

        <dxi-column caption="Artikel">
          <dxi-column dataField="product.code" caption="Šifra"></dxi-column>
          <dxi-column dataField="product.name" caption="Naziv"></dxi-column>
        </dxi-column>

        <dxi-column caption="ERP">
          <dxi-column dataField="quantity" caption="Količina"></dxi-column>
          <dxi-column dataField="measurementUnit.code" caption="EM"></dxi-column>
          <dxi-column dataField="limitDateFrom" dataType="date" caption="Datum od" cellTemplate="dateCellTemplate"></dxi-column>
          <dxi-column dataField="limitDateTo" dataType="date" caption="Datum do" cellTemplate="dateCellTemplate"></dxi-column>
        </dxi-column>

        <dxi-column alignment="center" dataField="" cellTemplate="planCellTemplate"></dxi-column>

        <div *dxTemplate="let cell of 'planCellTemplate'">
          <span class="span-link" (click)="showInfo(cell.data)">Planiraj</span>
        </div>
        <div *dxTemplate="let cell of 'dateCellTemplate'">
          {{ cell.displayValue | date:'mediumDate' }} {{ cell.displayValue | date:'shortTime' }}
        </div>
      </dx-data-grid>

      <div id="popup">
        <dx-popup class='popup' [resizeEnabled]="true" [showTitle]="true" title="Delovni nalog" [dragEnabled]="false" [closeOnOutsideClick]="true"
          [(visible)]="popupVisible">
          <div *dxTemplate="let data of 'content'">
            <dx-scroll-view>
              <div class="card-deck">
                <!-- <div class="card-header"></div> -->
                <div class="card-body">
                  <!-- <h5 class="card-title"></h5> -->
                  <h6>Šifra naloga:
                    <span> {{ (selectedPlanItemHierarchy$ | async).planItem.code }}</span>
                  </h6>
                  <h6>Artikel</h6>
                  <div>
                    <label>Šifra: </label> {{ (selectedPlanItemHierarchy$ | async).planItem.product.code }}
                  </div>
                  <div>
                    <label>Naziv: </label>
                    <span> {{ (selectedPlanItemHierarchy$ | async).planItem.product.name }}</span>
                  </div>
                  <h6>ERP</h6>
                  <div>
                    <label>Količina: </label>
                    <span> {{ (selectedPlanItemHierarchy$ | async).planItem.quantity }}</span>
                  </div>
                  <div>
                    <label>EM: </label>
                    <span> {{ (selectedPlanItemHierarchy$ | async).planItem.measurementUnit.code }}</span>
                  </div>
                  <div>
                    <label>Datum od: </label>
                    <span> {{ (selectedPlanItemHierarchy$ | async).planItem.limitDateFrom | date:'shortDate'}}</span>
                  </div>
                  <div>
                    <label>Datum do: </label>
                    <span> {{ (selectedPlanItemHierarchy$ | async).planItem.limitDateTo | date:'shortDate'}}</span>
                  </div>
                  <h6>Izbira alternative</h6>
                  <div class="dx-field">
                    <div class="dx-field-label">Alternativa: </div>
                    <div class="dx-field-value">
                      <dx-select-box 
                        [dataSource]="(selectedPlanItemHierarchy$ | async).alternativeOptions" 
                        valueExpr="id" 
                        displayExpr="name" 
                        placeholder="Izberi alternativo"
                        [showClearButton]="true"
                        (onValueChanged)="selectAlternative($event.value)">
                      </dx-select-box>
                    </div>
                  </div>
                  <app-alternative 
                    *ngIf="alternatives && selectedAlternative !== null" 
                    [alternative]="alternatives[selectedAlternative]">
                  </app-alternative>

                  <div>
                    <button type="button" class="btn btn-primary">Potdri</button>
                    <button type="button" class="btn btn-secondary">Prekliči</button>
                  </div>
                </div>
              </div>
            </dx-scroll-view>

          </div>


        </dx-popup>
      </div>
    </div>
  </div>
</div>

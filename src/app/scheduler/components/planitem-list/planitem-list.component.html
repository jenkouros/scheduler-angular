<div class="container-fluid">
  <div class="row">
    <div class="col">
      <dx-data-grid [columnAutoWidth]="true" [allowColumnResizing]="true" columnResizingMode="nextColumn" id="gridContainer" [dataSource]="planItemsStore"
        [showRowLines]="true" [rowAlternationEnabled]="true">
        <!-- [dataSource]="(planItemState$ | async).entities" -->

        <dxo-filter-row [visible]="true"></dxo-filter-row>

        <dxo-remote-operations [filtering]="true" [sorting]="false" [grouping]="false" [paging]="true" [summary]="false">
        </dxo-remote-operations>
        <!-- 
        <dxo-filter-row [visible]="true">
        </dxo-filter-row> -->
        <dxo-paging [pageSize]="12"></dxo-paging>
        <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[8, 12, 20]" [showInfo]="true" [showNavigationButtons]="true">
        </dxo-pager>

        <dxi-column dataField="code" caption="Šifra naloga"></dxi-column>
        <dxi-column dataField="" caption="Vrsta proizvodnje"></dxi-column>

        <dxi-column caption="Artikel">
          <dxi-column dataField="product.code" caption="Šifra"></dxi-column>
          <dxi-column dataField="product.name" caption="Naziv"></dxi-column>
        </dxi-column>

        <dxi-column caption="ERP">
          <dxi-column dataField="quantity" caption="Količina"></dxi-column>
          <dxi-column dataField="measurementUnit.code" caption="EM"></dxi-column>
          <dxi-column dataField="limitDateFrom" dataType="date" caption="Datum od" cellTemplate="dateCellTemplate"></dxi-column>
          <dxi-column dataField="limitDateTo" dataType="date" caption="Datum do" cellTemplate="dateCellTemplate"></dxi-column>
        </dxi-column>

        <dxi-column alignment="center" dataField="" cellTemplate="planCellTemplate"></dxi-column>

        <div *dxTemplate="let cell of 'planCellTemplate'">
          <span class="span-link" (click)="showInfo(cell.data)">Planiraj</span>
        </div>
        <div *dxTemplate="let cell of 'dateCellTemplate'">
          {{ cell.displayValue | date:'mediumDate' }} {{ cell.displayValue | date:'shortTime' }}
        </div>
      </dx-data-grid>



      <div id="popup"> 
        <dx-popup class='popup' 
          [resizeEnabled]="true"
          [showTitle]="true" 
          title="Delovni nalog" 
          [dragEnabled]="false" 
          [closeOnOutsideClick]="true"
          [(visible)]="popupVisible">
          <div *dxTemplate="let data of 'content'">

              <div class="dx-fieldset">
                <div class="dx-fieldset-header">Delovni nalog</div>
                <div class="dx-field">
                  <div class="dx-field-label">Šifra</div>
                  <div class="dx-field-value-static">{{ (selectedPlanItemHierarchy$ | async).planItem.code }}</div>
                </div>
                <div class="dx-field">
                  <div class="dx-field-label">Vrsta proizvodnje</div>
                  <div class="dx-field-value-static">vrsta proizvodnje</div>
                </div>
            </div>
            <div class="dx-fieldset">
                <div class="dx-fieldset-header">Artikel</div>
                <div class="dx-field">
                  <div class="dx-field-label">Šifra</div>
                  <div class="dx-field-value-static">{{ (selectedPlanItemHierarchy$ | async).planItem.product.code }}</div>
                </div>
                <div class="dx-field">
                  <div class="dx-field-label">Nazvi</div>
                  <div class="dx-field-value-static">{{ (selectedPlanItemHierarchy$ | async).planItem.product.name }}</div>
                </div>
            </div>
            <div class="dx-fieldset">
                <div class="dx-fieldset-header">ERP</div>
                <div class="dx-field">
                  <div class="dx-field-label">Količina</div>
                  <div class="dx-field-value-static">{{ (selectedPlanItemHierarchy$ | async).planItem.quantity }}</div>
                </div>
                <div class="dx-field">
                  <div class="dx-field-label">EM</div>
                  <div class="dx-field-value-static">{{ (selectedPlanItemHierarchy$ | async).planItem.measurementUnit.code }}</div>
                </div>
                <div class="dx-field">
                  <div class="dx-field-label">Datum od</div>
                  <div class="dx-field-value-static">{{ (selectedPlanItemHierarchy$ | async).planItem.limitDateFrom | date:'shortDate' }}</div>
                </div>
                <div class="dx-field">
                  <div class="dx-field-label">Datum do</div>
                  <div class="dx-field-value-static">{{ (selectedPlanItemHierarchy$ | async).planItem.limitDateTo | date:'shortDate' }}</div>
                </div>
            </div>          
            <div class="dx-fieldset">
              <div class="dx-fieldset-header">Izbira alternative</div>
              <div class="dx-field">
                <div class="dx-field-label">Alternativa</div>
                <div class="dx-field-value-static">
                  <dx-select-box
                    [dataSource]="(selectedPlanItemHierarchy$ | async).alternativeOptions"
                    valueExpr="id"
                    displayExpr="name"
                    placeholder="Izberi alternativo"
                    [showClearButton]="true"
                ></dx-select-box>
                </div>
              </div>
            </div>    
                
            <app-alternative [alternative]="(selectedPlanItemHierarchy$ | async).planItemHierarchy.alternatives[0]" ></app-alternative>
 
            <div class="dx-fieldset">
              <!-- <div class="dx-fieldset-header">#</div> -->
              <div class="dx-field">
                <!-- <div class="dx-field-label">#</div> -->
                <div class="dx-field-value-static">
                  <button type="button" class="btn btn-primary">Potdri</button>
                  <button type="button" class="btn btn-secondary">Prekliči</button>
                </div>
              </div>              
            </div>                          
          </div>


        </dx-popup>
      </div>
    </div>
  </div>
</div>
